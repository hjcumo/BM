<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°©ì—­ë§ˆíŠ¸ ë§ˆì§„ê³„ì‚°.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
        }
        .number-input::-webkit-outer-spin-button,
        .number-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .number-input {
            -moz-appearance: textfield;
        }
        
        .input-group label {
            color: #4A5568;
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        .input-group label .emoji, .result-item .emoji {
            margin-right: 0.5rem;
            font-size: 1.1em;
        }

        .input-field, .select-field {
            border: 1px solid #E2E8F0;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
            transition: border-color 0.2s, box-shadow 0.2s;
            background-color: #fff;
        }
        .input-field:focus, .select-field:focus {
            border-color: #6366F1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
            outline: none;
        }
        .input-field[readonly] {
            background-color: #F3F4F6;
            cursor: not-allowed;
            color: #374151;
            font-weight: 600;
        }
        .input-field.subtotal-field {
            background-color: #E9D5FF;
            color: #5B21B6;
            font-weight: 500;
        }

        .calculate-button {
            background-color: #4F46E5;
            color: white;
            font-size: 1.125rem;
            font-weight: 600;
            padding: 0.875rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            transition: all 0.2s ease-in-out;
        }
        .calculate-button:hover {
            background-color: #4338CA;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }
        .calculate-button:active {
            transform: translateY(1px);
        }

        .results-card {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .results-card.show {
            opacity: 1;
            transform: translateY(0);
        }

        .error-message {
            background-color: #FFF5F5;
            color: #C53030;
            border-left: 4px solid #E53E3E;
            padding: 1rem;
            border-radius: 0.375rem;
        }
        .hidden-element { display: none; }

        .product-dropdown {
            position: absolute;
            background-color: white;
            border: 1px solid #E2E8F0;
            border-top: none;
            border-radius: 0 0 0.5rem 0.5rem;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            left:0; right:0;
        }
        .product-dropdown-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            font-size: 0.875rem;
        }
        .product-dropdown-item:hover {
            background-color: #F7FAFC;
        }
        .product-dropdown-item .product-price {
            font-size: 0.75rem;
            color: #718096;
            margin-left: 0.5rem;
        }

        .quantity-control-button {
            background-color: #E0E7FF;
            color: #4338CA;
            border: 1px solid #C7D2FE;
            padding: 0.3rem 0.6rem;
            font-size: 0.8rem;
            font-weight: bold;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
            line-height: 1;
        }
        .quantity-control-button:hover {
            background-color: #C7D2FE;
        }
        .quantity-input-wrapper { display: flex; align-items: center; }
        .quantity-input-wrapper input {
            text-align: center;
            border-left: 0; border-right: 0;
            border-top: 1px solid #E2E8F0; border-bottom: 1px solid #E2E8F0;
            border-radius: 0;
            flex-grow: 1;
            padding: 0.3rem 0.5rem;
            box-shadow: none;
            background-color: #fff;
        }
        .quantity-input-wrapper .quantity-control-button:first-child { border-top-right-radius: 0; border-bottom-right-radius: 0; }
        .quantity-input-wrapper .quantity-control-button:last-child { border-top-left-radius: 0; border-bottom-left-radius: 0; }
        
        .delete-product-line-button {
            background-color: #FEE2E2;
            color: #B91C1C;
            border: 1px solid #FECACA;
            padding: 0.4rem 0.6rem;
            font-size: 0.75rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }
        .delete-product-line-button:hover { background-color: #FECACA; }
        
        .add-product-button {
            background-color: #DBEAFE;
            color: #1E40AF;
            border: 1px solid #BFDBFE;
            transition: background-color 0.2s;
        }
        .add-product-button:hover { background-color: #BFDBFE; }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="bg-white p-6 sm:p-8 lg:p-10 rounded-xl shadow-2xl w-full max-w-5xl">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-8 lg:mb-12">
            <span class="emoji" role="img" aria-label="calculator">ğŸœ</span> HBíŒë§¤ ë§ˆì§„ ê³„ì‚°ê¸°
        </h1>

        <form id="marginForm" class="space-y-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 bg-gray-50 p-6 rounded-lg border">
                <div class="input-group">
                    <label for="salePrice" class="block text-base font-medium text-gray-700 mb-2"><span class="emoji" role="img" aria-label="money bag">ğŸ’°</span>íŒë§¤ê°€ê²© (ì›)</label>
                    <input type="text" id="salePrice" name="salePrice" placeholder="íŒë§¤í•  ê°€ê²© ì…ë ¥" required class="number-input mt-1 block w-full input-field text-lg font-semibold">
                </div>
                <div class="input-group">
                    <label for="totalPurchasePrice" class="block text-base font-medium text-gray-700 mb-2"><span class="emoji" role="img" aria-label="shopping cart">ğŸ›’</span>ì´ ë§¤ì…ê°€ (ì›)</label>
                    <input type="text" id="totalPurchasePrice" name="totalPurchasePrice" placeholder="ìë™ ê³„ì‚°" readonly required class="number-input mt-1 block w-full input-field text-lg">
                </div>
            </div>

            <div class="input-group border border-gray-200 p-5 rounded-lg">
                <label class="block text-base font-semibold text-gray-700 mb-4"><span class="emoji" role="img" aria-label="package">ğŸ“¦</span>ìƒí’ˆ ë§¤ì… êµ¬ì„±</label>
                
                <div id="productLinesContainer" class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6">
                    <div class="product-line-item border border-gray-200 rounded-lg p-4" data-line-id="1">
                        <div class="flex justify-between items-start mb-4">
                            <div class="input-group">
                                <label class="block text-sm font-medium text-gray-700 mb-2">ë§¤ì… ë‹¨ê°€ íƒ€ì… 1</label>
                                <div class="flex space-x-4">
                                    <div class="flex items-center"><input type="radio" id="purchaseTypeRegistered-1" name="purchaseType-1" value="registered" checked class="h-4 w-4"><label for="purchaseTypeRegistered-1" class="ml-2 text-sm">ë“±ë¡</label></div>
                                    <div class="flex items-center"><input type="radio" id="purchaseTypeUnregistered-1" name="purchaseType-1" value="unregistered" class="h-4 w-4"><label for="purchaseTypeUnregistered-1" class="ml-2 text-sm">ë¯¸ë“±ë¡</label></div>
                                </div>
                            </div>
                        </div>
                        <div class="registered-product-section">
                            <div class="relative mb-2"><input type="text" id="productSearchInput-1" placeholder="ìƒí’ˆëª… ê²€ìƒ‰..." class="product-search-input mt-1 block w-full input-field text-sm"><div class="product-dropdown hidden"></div></div>
                            <div class="grid grid-cols-10 gap-x-2 items-end">
                                <div class="col-span-4"><label class="block text-xs mb-1">ë‹¨ê°€</label><input type="text" id="unitPurchasePrice-1" readonly class="unit-purchase-price-input number-input w-full input-field text-sm"></div>
                                <div class="col-span-3"><label class="block text-xs mb-1">ìˆ˜ëŸ‰</label><div class="quantity-input-wrapper mt-0"><button type="button" class="decrease-quantity quantity-control-button">-</button><input type="number" id="quantity-1" value="1" min="1" class="quantity-input number-input w-full input-field text-sm"><button type="button" class="increase-quantity quantity-control-button">+</button></div></div>
                                <div class="col-span-3"><label class="block text-xs mb-1">ì†Œê³„</label><input type="text" id="lineSubtotal-1" readonly class="line-subtotal-display number-input w-full input-field text-sm subtotal-field"></div>
                            </div>
                        </div>
                        <div class="unregistered-product-section hidden-element">
                            <div class="relative mb-2"><input type="text" id="unregisteredProductName-1" placeholder="ë¯¸ë“±ë¡ ìƒí’ˆëª…..." class="unregistered-product-name-input mt-1 block w-full input-field text-sm"></div>
                            <div class="grid grid-cols-10 gap-x-2 items-end">
                                <div class="col-span-4"><label class="block text-xs mb-1">ë‹¨ê°€</label><input type="text" id="unregisteredUnitPrice-1" placeholder="ì˜ˆ: 15,000" class="unregistered-unit-price-input number-input w-full input-field text-sm"></div>
                                <div class="col-span-3"><label class="block text-xs mb-1">ìˆ˜ëŸ‰</label><div class="quantity-input-wrapper mt-0"><button type="button" class="decrease-quantity quantity-control-button">-</button><input type="number" id="unregisteredQuantity-1" value="1" min="1" class="unregistered-quantity-input number-input w-full input-field text-sm"><button type="button" class="increase-quantity quantity-control-button">+</button></div></div>
                                <div class="col-span-3"><label class="block text-xs mb-1">ì†Œê³„</label><input type="text" id="unregisteredLineSubtotal-1" readonly class="line-subtotal-display number-input w-full input-field text-sm subtotal-field"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" id="addProductLineButton" class="mt-4 text-sm add-product-button font-medium py-2 px-4 rounded-md w-full"><span class="emoji" role="img" aria-label="plus">â•</span> êµ¬ì„± ìƒí’ˆ ì¶”ê°€ (ìµœëŒ€ 4ê°œ)</button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-8 pt-4 border-t">
                <div class="input-group">
                    <label class="block text-sm font-medium mb-2"><span class="emoji" role="img" aria-label="briefcase">ğŸ§‘â€ğŸ’¼</span>íŒë§¤íƒ€ì…</label>
                    <div class="flex space-x-4"><div class="flex items-center"><input id="typeBusiness" name="salesType" type="radio" value="business" checked class="h-4 w-4"><label for="typeBusiness" class="ml-2 text-sm">ì‚¬ì—…ì (3.7%)</label></div><div class="flex items-center"><input id="typeMember" name="salesType" type="radio" value="member" class="h-4 w-4"><label for="typeMember" class="ml-2 text-sm">íšŒì› (3.7%)</label></div><div class="flex items-center"><input id="typeGeneral" name="salesType" type="radio" value="general" class="h-4 w-4"><label for="typeGeneral" class="ml-2 text-sm">ì¼ë°˜ (13%)</label></div></div>
                </div>
                <div class="input-group">
                    <label class="block text-sm font-medium mb-2"><span class="emoji" role="img" aria-label="delivery truck">ğŸšš</span>ê³ ê°ë¶€ë‹´ ë°°ì†¡ë¹„</label>
                    <div class="flex space-x-6 items-start"><div class="space-y-2"><div class="flex items-center"><input id="shippingFree" name="customerShippingType" type="radio" value="free" checked class="h-4 w-4"><label for="shippingFree" class="ml-2 text-sm">ë¬´ë£Œë°°ì†¡</label></div><div class="flex items-center"><input id="shippingPaid" name="customerShippingType" type="radio" value="paid" class="h-4 w-4"><label for="shippingPaid" class="ml-2 text-sm">ìœ ë£Œë°°ì†¡</label></div></div><div id="customerShippingAmountGroup" class="hidden flex-1"><select id="customerShippingAmount" name="customerShippingAmount" class="w-full select-field"><option value="3000">3,000ì›</option><option value="5000">5,000ì›</option></select><p class="mt-1 text-xs text-gray-500">ìˆ˜ìˆ˜ë£Œ 3.3% ì ìš©</p></div></div>
                </div>
                <div class="input-group">
                    <label for="packagingCostRate" class="block text-sm font-medium mb-2"><span class="emoji" role="img" aria-label="gift">ğŸ</span>í¬ì¥ë¹„ìš© (ì¸ê±´ë¹„ í¬í•¨)</label>
                    <select id="packagingCostRate" name="packagingCostRate" class="mt-1 block w-full select-field"><option value="0.02">íŒë§¤ê°€ ëŒ€ë¹„ 2%</option><option value="0.03">íŒë§¤ê°€ ëŒ€ë¹„ 3%</option><option value="0.04">íŒë§¤ê°€ ëŒ€ë¹„ 4%</option></select>
                </div>
                <div class="input-group">
                    <label for="outgoingShippingCost" class="block text-sm font-medium mb-2"><span class="emoji" role="img" aria-label="shipping box">ğŸš›</span>ì¶œê³ ë°°ì†¡ë¹„ (ì›)</label>
                    <select id="outgoingShippingCost" name="outgoingShippingCost" class="mt-1 block w-full select-field">
                        <option value="2250">ê·¹ì†Œ - 2,250ì›</option>
                        <option value="2350">ì†Œ1 - 2,350ì›</option>
                        <option value="2670">ì†Œ2 - 2,670ì›</option>
                        <option value="3200">ì¤‘ - 3,200ì›</option>
                        <option value="5000">ëŒ€í˜• - 5,000ì›</option>
                        <option value="5500">ì´í˜• - 5,500ì›</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="block text-sm font-medium mb-2"><span class="emoji" role="img" aria-label="megaphone">ğŸ“¢</span>ê´‘ê³ ì§‘í–‰</label>
                    <div class="flex space-x-4">
                        <div class="flex items-center">
                            <input id="adNo" name="advertising" type="radio" value="no" class="h-4 w-4">
                            <label for="adNo" class="ml-2 text-sm">ì§„í–‰ì•ˆí•¨</label>
                        </div>
                        <div class="flex items-center">
                            <input id="adYes" name="advertising" type="radio" value="yes" checked class="h-4 w-4">
                            <label for="adYes" class="ml-2 text-sm">ì§„í–‰</label>
                        </div>
                    </div>
                </div>
                <div id="advertisingCostGroup" class="input-group">
                    <label for="advertisingRate" class="block text-sm font-medium mb-2"><span class="emoji" role="img" aria-label="bar chart">ğŸ“Š</span>ê´‘ê³ ë¹„ (%)</label>
                    <input type="number" id="advertisingRate" name="advertisingRate" placeholder="íŒë§¤ê°€ ëŒ€ë¹„ ë¹„ìœ¨(%)" class="number-input mt-1 block w-full input-field">
                </div>
            </div>

            <div class="pt-6"><button type="submit" class="w-full calculate-button">ê³„ì‚°í•˜ê¸°</button></div>
        </form>

        <div id="results-container"></div>
        <div id="errorMessage" class="mt-6 error-message hidden-element"></div>
    </div>
    
    <script>
        // Raw product data
        const productData = [
            { name: "ì œì‘*ì›í„°ì¹˜ìº¡ 1ìº¡", price: 13.2 }, { name: "ë°”í€´íŠ¸ë©ê±°ì¹˜ëŒ€ ì–‘ë©´í…Œì´í”„í˜•", price: 275.0 },
            { name: "êµ­ë³´ ë ˆì „ë“œ ê²” 220g", price: 14500.0 }, { name: "ë°”í€´ë²Œë ˆ ì‚¬ê° ë¨¹ì´ìº¡ 6ìº¡", price: 33.0 },
            { name: "ë°”í€´íŠ¸ë©ê±°ì¹˜ëŒ€ ìì„í˜•", price: 550.0 }, { name: "ì‚¼í˜„ì†Œë…ìš©ì—íƒ„ì˜¬ 83% 250ml", price: 750.0 },
            { name: "ë³´ë ¹ í™ˆë¼ì´í”„ ìŠˆí¼ìš¸íŠ¸ë¼ ì—ì–´ì¡¸ 500ml", price: 2420.0 }, { name: "í‚¬íŒŒí”„ ë°”í€´ë²Œë ˆ ì œê±°ì œ(ì‘ì€ë°”í€´ìš©) 12ê°œì… zero", price: 3630.0 },
            { name: "ë§¥ìŠ¤í¬ìŠ¤ í€€í…€ 30g", price: 10670.0 }, { name: "ê·¸ë¦°ì„¸ì´í”„ ë§¤íŠ¸ í›ˆì¦ê¸°", price: 3135.0 },
            { name: "ë³´ë ¹ ê·¸ë¦°ì„¸ì´í”„ ë¦¬í•„(45ì¼)", price: 1650.0 }, { name: "í‚¬íŒŒí”„ ë°”í€´ë²Œë ˆ ì œê±°ì œ(í°ë°”í€´ìš©) 6ê°œì… zero", price: 3509.0 },
            { name: "í—ˆë¸Œ ê°œë¯¸íŒŒì›Œ ê³¼ë¦½ 1g*5ê°œ", price: 2310.0 }, { name: "í‚¬íŒŒí”„ ê·¸ë¦° ì—ì–´ì¡¸ 420ml", price: 2552.0 },
            { name: "ë³´ë ¹ ë§¤íŠ¸ì—ìŠ¤ ì „ìëª¨ê¸°í–¥ ë¦¬í•„(60ë§¤)", price: 1925.0 }, { name: "ì¡ìŠ¤ í¼í™íŠ¸í‚¬ ì—ì–´ì¡¸ 500ml", price: 2860.0 },
            { name: "ì œíŠ¸íŒŒì›Œ ìš¸íŠ¸ë¼ í‚¬ë¼ì—ì–´ì¡¸ 420ml", price: 1870.0 }, { name: "ë³´ë ¹ ê·¸ë¦°ì„¸ì´í”„ ë¦¬í•„(90ì¼)", price: 1870.0 },
            { name: "êµ­ë‚´ì‚° í™”ë‘ê³¡ë‚˜ë°©íŠ¸ë© 1ê°‘*2ë§¤", price: 1100.0 }, { name: "ì•¼ì˜¹(ì‹¸ë˜ê¸°) 50g", price: 800.0 },
            { name: "í‚¬íŒŒí”„ ìš¸íŠ¸ë¼ íŒŒì›Œ 500ml", price: 3289.0 }, { name: "í‚¬íŒŒí”„ ê·¸ë¦° ê°œë¯¸ì—ì–´ì¡¸ 250ml", price: 2123.0 },
            { name: "ë³´ë ¹ ë¡œí•˜ìŠ¤ í‚¤í¼ ë„¤ì¸„ëŸ´ ì˜¤ë Œì§€ 450ml", price: 1738.0 }, { name: "ë³´ë ¹ ë¡œí•˜ìŠ¤ í‚¤í¼ 450ml", price: 1738.0 },
            { name: "ë³´ë ¹ í”ŒëŸ¬ìŠ¤ í”¼í†¤ì¹˜ë“œ ì—ì–´ì¡¸ 500ml", price: 1815.0 }, { name: "ì¥ ì•½ ìš©ê¸°", price: 35.2 },
            { name: "í‚¬íŒŒí”„ êµ¿ë‚˜ì‡ ì—í”„ì—ì–´ë¡œì¡¸(í”¼í†¤ì¹˜ë“œ) 500ml", price: 2607.0 }, { name: "ë””íœìŠ¤ì¡´ ì—ìŠ¤ì—ì–´ë¡œì†”(ë¬´í–¥) 180ml", price: 1650.0 },
            { name: "ì œíŠ¸íŒŒì›Œ ê°œë¯¸í‚¬ë¼ 300ml", price: 1650.0 }, { name: "ë…¸ëŸ° í”Œë¼ì´ë‹¤ìš´ 1ê°‘*10ë§¤", price: 1320.0 },
            { name: "ë…¸ëŸ° ì¥ë³¸ë“œ ìŠ¤í˜ì…œ 1ê°‘*2ë§¤", price: 506.0 }, { name: "ì œíŠ¸íŒŒì›Œ ë¡œì·¨ìº£ì·¨ í°ë°”í€´ìš© 6ê°œì…", price: 2090.0 },
            { name: "ì œíŠ¸íŒŒì›Œ ë¡œì·¨ìº£ì·¨ ì‘ì€ë°”í€´ìš© 12ê°œì…", price: 2090.0 }, { name: "í‚¬íŒŒí”„ ì—ì–´ë¡œì¡¸ ë‚´ì¸„ëŸ´ì˜¤ë Œì§€ 500ml", price: 2739.0 },
            { name: "ë³´ë ¹ ê·¸ë¦°ì„¸ì´í”„ ì•¡ì²´í›ˆì¦ê¸°(ì½”ë“œí˜•)", price: 4620.0 }, { name: "ì¥ í‘œì‹ì§€(ê°€ë¡œí˜•)", price: 550.0 },
            { name: "ë³´ë ¹ ê·¸ë¦°ì„¸ì´í”„ ì•¡ì²´í›ˆì¦ê¸°(í”ŒëŸ¬ê·¸í˜•)", price: 4510.0 }, { name: "ë¸íƒ€íŒŒì›Œ ìœ ì œ 250ml", price: 2695.0 },
            { name: "í‚¬íŒŒí”„ ë¦¬í€´ë“œì¼€ì´ 48ì¼ ë¦¬í•„", price: 1210.0 }, { name: "ì œíŠ¸íŒŒì›Œ ì•¤íŠ¸í‚¬(6ê°œì…)", price: 1870.0 },
            { name: "ë§ˆìš°ìŠ¤ì˜¬í‚¬ ë¸”ëŸ­ 100g", price: 1760.0 }, { name: "íŒŒì›Œí‚¬ ë§¥ìŠ¤ 100g", price: 2310.0 },
            { name: "ë…¸ëŸ° ì¥ ëˆëˆì´ íŠ¸ë© 1ê°‘*2ë§¤", price: 880.0 }, { name: "ë…¸ëŸ° ì™•íŒŒë¦¬ëˆëˆì´ 1ê°‘*5ë§¤", price: 468.0 },
            { name: "ë§ˆìš°ìŠ¤í‚¹ ì‚°ì œ 100g", price: 2750.0 }, { name: "ìŠ¤ì¹´ì´ì› ë¸”ë™í‚¤í†  ì¹´íŠ¸ë¦¬ì§€ 5ë§¤", price: 2750.0 },
            { name: "í‚¬íŒŒí”„ ì–´ì›¨ì´ ì—ì–´ë¡œì¡¸ 200ml", price: 2442.0 }, { name: "ì¡ìŠ¤ì—í”„ì—‘ìŠ¤ë§ˆì¼ë“œê°€ë“œ 200ml", price: 3190.0 },
            { name: "êµ¿ë‚˜ì‡ì—ìŠ¤ë§¤íŠ¸ 60ë§¤", price: 2376.0 }, { name: "í‚¬íŒŒí”„ ë‚´ì¸„ëŸ´ ì´ˆíŒŒë¦¬ ìœ ì œ 290ml", price: 3058.0 },
            { name: "í‚¬íŒŒí”„ ì´ˆíŒŒë¦¬íŠ¸ë© 15ml", price: 4257.0 }, { name: "í‚¬íŒŒí”„ ì–´ì›¨ì´ ì—ì–´ë¡œì¡¸ 100ml", price: 2079.0 },
            { name: "ì‚¼í˜„ì†Œë…ìš©ì—íƒ„ì˜¬ 83% 500ml", price: 1450.0 }, { name: "ì¿ ë§ˆíœí ë › 100g", price: 1700.0 },
            { name: "í¬ë¡œë°” ë¶€ì†í’ˆ ì•½ì œë§ˆê°œ", price: 2200.0 }, { name: "ë§¥ìŠ¤í¬ìŠ¤ ì…€ë ‰íŠ¸ ì´ì§€ê²” 20g", price: 5720.0 },
            { name: "ë¼ì¿ ë¯¼ í‹°í”¼ 1kg", price: 26400.0 }, { name: "ì— íŠ¸ë© ê³¨ë“œ ê¸€ë£¨í˜ì´í¼ 1set*5ë§¤", price: 2750.0 },
            { name: "ìš¸íŠ¸ë¼357 ì¹´íŠ¸ë¦¬ì§€ 1set (ìƒ,í•˜)", price: 1320.0 }, { name: "í‚¬íŒŒí”„ ì§„ë“œê¸° ì‹¹ ì•¡ì œ 400ml", price: 3619.0 },
            { name: "í”¼í”„ë¡œê²”(ì‹œë¦°ì§€) 35g", price: 1650.0 }, { name: "ì‹¸ì´ì–¸ í™€ ì¹´íŠ¸ë¦¬ì§€", price: 990.0 },
            { name: "ë¼ì¿ ë¯¼ í‹°í”¼ 100g", price: 3520.0 }, { name: "OEM ì•„ë¡œë§ˆ ì¥ ëˆëˆì´ 1ê°‘*2ë§¤", price: 880.0 },
            { name: "OEM ì•„ë¡œë§ˆ M íŠ¸ë© 1ì¤„*4ì¹¸", price: 143.0 }, { name: "IVTì—ì–´ì¡¸ 500ml", price: 2255.0 },
            { name: "í‚¬íŒŒí”„ ì „ê¸°ë§¤íŠ¸ í›ˆì¦ê¸°", price: 3388.0 }, { name: "ì‚¼í˜„ì†Œë…ìš©ì—íƒ„ì˜¬ 83% 1L", price: 2450.0 },
            { name: "ìš¸íŠ¸ë¼ë§¥ìŠ¤(ê²”) íŠœë¸Œ 40g", price: 3000.0 }, { name: "ìœ™ì§‘ ì¹´íŠ¸ë¦¬ì§€", price: 990.0 },
            { name: "ì¿ ë§ˆíœì¥í‚¬(ë¸”ë¡) 100g", price: 2200.0 }, { name: "í”„ë¦¬ì—  P-1 ì¹´íŠ¸ë¦¬ì§€", price: 1100.0 },
            { name: "ë¹„ì˜¤í‚¬ 500ml", price: 7000.0 }, { name: "ìœˆë”” ì¹´íŠ¸ë¦¬ì§€", price: 1320.0 },
            { name: "ë¸”ë£¨ë²„ë“œ ì¹´íŠ¸ë¦¬ì§€ 1set (ìƒ,í•˜)", price: 1320.0 }, { name: "ë‘ë”ì§€ ì‹¹ 100g", price: 2200.0 },
            { name: "í¬ë¡œë°” ë¶€ì†í’ˆ í˜¸ìŠ¤ 1.5m", price: 3080.0 }, { name: "í¬ë¡œë°” ë¶€ì†í’ˆ ì†ì¡ì´", price: 3520.0 },
            { name: "NEC 20W ìœ ë¬¸ë“±", price: 8250.0 }, { name: "í•„ë¦½ìŠ¤ 24W ìœ ë¬¸ë“±", price: 7700.0 },
            { name: "ë¬´ë¬´ìŠ¤ê°€ë“œì•¡ 80ml", price: 3500.0 }, { name: "ì—°ì˜ˆì¸ ë§ˆìŠ¤í¬", price: 0 },
            { name: "êµ¬ì„œí„°ë„(å°)", price: 1320.0 }, { name: "ë¬´ë¬´ìŠ¤ê°€ë“œ í”ŒëŸ¬ìŠ¤(60ml))", price: 4200.0 },
            { name: "ë‹¤ì´ì•„ì œíƒ€ ì‚°ì œ 350g", price: 6000.0 }, { name: "ë‹¥í„°í¬ë¦° ì•¡ì œ 1L", price: 11000.0 },
            { name: "ì¡ìŠ¤ìš¸íŠ¸ë¼ì—ì–´ì†”(ë ˆëª¬í–¥) 500ml", price: 3465.0 }, { name: "ë¼ì¿ ë¯¼ í˜ì´ìŠ¤íŠ¸ 100g(10g*10ê°œ)", price: 3850.0 },
            { name: "ë‹¥í„°í¬ë¦° 450ml", price: 3500.0 }, { name: "ì¡°ì€ ì†Œë…ìš© ì—íƒ„ì˜¬ 95% 4L", price: 14000.0 },
            { name: "ìš¸íŠ¸ë¼ë§¥ìŠ¤(ê²”) 220g", price: 9000.0 }, { name: "ë²…ìŠ¤ì˜¬í‚¬ ìœ ì œ 500ml", price: 3300.0 },
            { name: "ìš¸íŠ¸ë¼ë§¥ìŠ¤(ê²”) ì‹œë¦°ì§€ 35g", price: 3800.0 }, { name: "ë…¸ëŸ° í•˜ë“œë³´ë“œ 1ê°‘*2ë§¤", price: 1122.0 },
            { name: "í‚¬íŒŒí”„ ì¢€ë²Œë ˆ ì œë¡œ (ì„œëì¥ìš©) 20ê°œì…", price: 5082.0 }, { name: "ì•¤íŠ¸ë¼ì´ì˜¨ 30g", price: 5500.0 },
            { name: "ë¹„ì˜¤ìƒ·(ìˆ˜ì„±/ì €ë…ì„±) 500ml", price: 3850.0 }, { name: "í•„ë¦½ìŠ¤ 15W ìœ ë¬¸ë“±", price: 5830.0 },
            { name: "ì¡ìŠ¤ ìŠ¤í†° 500g", price: 10450.0 }, { name: "í‚¬íŒŒí”„ ë¦¬í€´ë“œì¼€ì´ (ì½”ë“œí˜•)", price: 4950.0 },
            { name: "ë§¥ìŠ¤í¬ìŠ¤ í€€í…€ 12g", price: 5390.0 }, { name: "ë¬´ë¬´ìŠ¤ê°€ë“œí”ŒëŸ¬ìŠ¤(110ml)", price: 5800.0 },
            { name: "êµ­ë³´ ë ˆì „ë“œ ê²”(ì‹œë¦°ì§€) 35g", price: 4000.0 }, { name: "ì‹¤ë°”ë‹ˆì•„ 36W ìœ ë¬¸ë“±", price: 6380.0 },
            { name: "15W í¬ì¶©ë“± (Uìí˜•)", price: 6600.0 }, 
            { name: "ìœ ì„ í˜• ì¥ ë¨¹ì´ìƒì", price: 1320.0 }, { name: "ì•„ì„íŒŒì¸ í”¼í†¤ì¹˜ë“œì‚´ê· ì œ 500ml", price: 5500.0 },
            { name: "ì‚¼í˜„ì†Œë…ìš©ì—íƒ„ì˜¬ 83% 4L", price: 8800.0 }, { name: "ìƒˆë¶€ë¦¬í˜• ë§ˆìŠ¤í¬ (í“¨ì–´í™”ì´íŠ¸) ëŒ€í˜• 1ë´‰ì§€*10ë§¤ì…", price: 88.0 },
            { name: "ë”í‚¬ì¡´ 1L", price: 7920.0 }, { name: "ì¿ ë§ˆíœí ë › 500g", price: 6500.0 },
            { name: "ì‹¸ì´í¼í‚¬ ìœ ì œ 1L", price: 15500.0 }, { name: "ë§¥ìŠ¤í¬ìŠ¤ ì…€ë ‰íŠ¸ ì´ì§€ê²” 230g", price: 19800.0 },
            { name: "í•„ë¦½ìŠ¤ 18W ìœ ë¬¸ë“±", price: 7150.0 }, { name: "í‚¬íŒŒí”„ ì§„ë“œê¸°ì‹¹ ì•¡ì œ 290mL", price: 3135.0 },
            { name: "ë§ˆìš°ìŠ¤ì˜¬í‚¬ ë¸”ëŸ­ 500g", price: 7700.0 }, { name: "ì¡ìŠ¤ê°œë¯¸ìš©ê³¼ë¦½ 250g", price: 26400.0 },
            { name: "ë²¤ì£¼ë¡  íƒ€ë¸”ë¦¿ 10g (1g * 10)", price: 4400.0 }, { name: "ë¬´ë¬´ìŠ¤ê°€ë“œí”ŒëŸ¬ìŠ¤(200ml)", price: 9000.0 },
            { name: "í”„ë¡œí… ìœ ì œ 500ml", price: 16500.0 }, { name: "í”¼í”„ë¡œì•¤íŠ¸ê²”(íŠœë¸Œ) 30g", price: 3300.0 },
            { name: "í‚¬íŒŒí”„ ë¦¬í€´ë“œì¼€ì´ (í”ŒëŸ¬ê·¸í˜•)", price: 4290.0 }, { name: "ì¿ ë§ˆíœì¥í‚¬(ë¸”ë¡) 500g", price: 8800.0 },
            { name: "ì œíƒ€í‚¬(ìœ ì„±/ê³ ë…ì„±) 300ml", price: 5500.0 }, { name: "íŒŒì›Œíƒˆì·¨ì œ(ìº”) 280ml", price: 5500.0 },
            { name: "í¬ë¡œë°” ì••ì¶• ë¶„ë¬´ê¸° 3L", price: 27500.0 }, { name: "ì• ë‹ˆìŠ¤í†±", price: 9350.0 },
            { name: "í¬ë¦°ë² ì´íŠ¸ ì•¤íŠ¸ê³¼ë¦½ 100g", price: 9500.0 },
            { name: "ì¡ìŠ¤ìš¸íŠ¸ë¼í”„ë¼ì„ê²” 230g", price: 5500.0 }, { name: "ë¡±ë‹¤ìš´í”ŒëŸ¬ìŠ¤ 1L", price: 24000.0 },
            { name: "ì™¸ê³½ìš© ì¥ ë°•ìŠ¤", price: 3080.0 }, { name: "ë¹„ì˜¤ì‹¸ì´í¼í‚¬ìœ ì œ 1L", price: 13200.0 },
            { name: "í¬ë¡œë°” ì••ì¶• ë¶„ë¬´ê¸° 5L", price: 29700.0 }, { name: "í¬ë¡œë°” ë¶€ì†í’ˆ ì••ì¶•ë´‰ 3L,5Lí˜¸í™˜", price: 10450.0 },
            { name: "ë§ˆìš°ìŠ¤í‚¹ ì‚°ì œ 1kg", price: 17600.0 }, { name: "ì¡ìŠ¤í™”ì´íŠ¸íœìŠ¤í”ŒëŸ¬ìŠ¤ì—ì–´ë¡œì†” 400ml", price: 3960.0 },
            { name: "í¬ë¡œë°” ë¶€ì†í’ˆ 2ë‹¨ë…¸ì¦ëŒ€ 98cm", price: 7700.0 }, { name: "ëŒë‹¤í‚¬ MC 1L", price: 35000.0 },
            { name: "í˜ìŠ¤íŠ¸ë¸íƒ€ 1L", price: 13200.0 }, { name: "ì¡ìŠ¤ì•¤íŠ¸ì˜¬í‚¬ 30g", price: 4620.0 },
            { name: "ìŠ¤ì¹´ì´F ì¹´íŠ¸ë¦¬ì§€ B", price: 594.0 }, { name: "5W í¬ì¶©ë“± (LED)", price: 22000.0 },
            { name: "í”¼í”„ë¡œê²” í”„ë¦¬ë¯¸ì—„ 250g", price: 7150.0 }, { name: "ì œíƒ€ê²” 250g", price: 6050.0 },
            { name: "í”„ë¡œí…í™ˆ 290ml", price: 6000.0 }, { name: "ë”í‚¬ì¡´ 2.1L", price: 14080.0 },
            { name: "ì¡ìŠ¤ì˜¬í‚¬ìŠ¤ë§ˆíŠ¸ 1L", price: 18150.0 }, { name: "ì¡ìŠ¤ë²„ê·¸í‚¬ìœ ì œ 1L", price: 22550.0 },
            { name: "ë¹„ì‚°ë°©ì§€ë¨í”„ TL-D BL 18W [í•„ë¦½ìŠ¤]", price: 12100.0 }, { name: "í˜ìŠ¤íŠ¸ì œë¡œ 1L", price: 14850.0 },
            { name: "ë¹„ì‚°ë°©ì§€ë¨í”„ í•„ë¦½ìŠ¤ actinic BL 15W [15W]", price: 11000.0 },
            { name: "ë¹„ì˜¤ë¸íƒ€ìœ ì œ 1L", price: 16500.0 }, { name: "ë¹„ì˜¤ëŒë‹¤ìœ ì œ 1L", price: 16500.0 },
            { name: "ë¹„ì˜¤í…Œë©”ê³¼ë¦½ 1kg", price: 15400.0 }, { name: "ë¹„ì‚°ë°©ì§€BLë¨í”„ PL-L 24W [í•„ë¦½ìŠ¤]", price: 13200.0 },
            { name: "ë¹„ì˜¤í…Œë©”ìœ ì œ 500ml", price: 18700.0 }, { name: "ë²…ìŠ¤ì¡´ ê°œë¯¸ê³¼ë¦½ 250g", price: 22000.0 },
            { name: "ë¹„ì˜¤í”¼ë ˆíŠ¸ë¦°ìœ ì œ 1L", price: 24200.0 }, { name: "ì‹¤ë°”ë‹ˆì•„ ë¹„ì‚°ë°©ì§€ë¨í”„ BL PL-L [36W]", price: 14300.0 },
            { name: "ì— íŠ¸ë© ê³¨ë“œ í¬ì¶©ê¸°", price: 33000.0 }, { name: "í‚¬ë¼ë°”íŠ¸ìœ„ìŠ¤íŠ¸ 100g (5g x 10ea 2bag)", price: 24000.0 },
            { name: "ë‹¥í„°í¬ë¦° 4L", price: 22000.0 }, { name: "ìŠ¤ì¹´ì´ì› ìŠ¤ì¹´ì´íŠ¸ë©", price: 33000.0 },
            { name: "ë”í‚¬ì¡´ 4.2L", price: 23100.0 }, { name: "ì—í† íŒŒì›Œí‚¬ 1L", price: 27500.0 },
            { name: "ë¹„ì‚°ë°©ì§€ NEC BL20 [FL20SBL]", price: 16280.0 }, { name: "ë²¤ì£¼ë¡  íƒ€ë¸”ë¦¿ 100g", price: 19800.0 },
            { name: "ìŠ¤ë§ˆíŠ¸ìºì¹˜ ì¹´íŠ¸ë¦¬ì§€ A 1set (ìƒ,í•˜)", price: 825.0 }, { name: "ë¹„ì˜¤ì—í† ìœ ì œ 1L", price: 29700.0 },
            { name: "ì¡°ì€ ì†Œë…ìš© ì—íƒ„ì˜¬ 95% 18L", price: 36000.0 },
            { name: "ìŠ¤ì¹´ì´ì› ìŠ¤ì¹´ì´ì—  í¬ì¶©ê¸° BLB", price: 55000.0 },
            { name: "ìŠ¤ì¹´ì´ì› ìŠ¤ì¹´ì´ì—  í¬ì¶©ê¸° LED", price: 77000.0 }, { name: "ë¹„ì˜¤ìƒ·(ìˆ˜ì„±/ì €ë…ì„±) 5L", price: 33000.0 },
            { name: "ë¹„ì˜¤í˜ë…¸í‚¬ìœ ì œ 1L", price: 33000.0 },
            { name: "ìŠ¤ì¹´ì´ì› ë¸”ë™í‚¤í†  LED í¬ì¶©ê¸°", price: 60500.0 }, { name: "ì‚¼í˜„ì†Œë…ìš©ì—íƒ„ì˜¬ 83% 18L", price: 35000.0 },
            { name: "ìŠ¤ì¹´ì´ì› ë¸”ë™í‚¤í†  BLB í¬ì¶©ê¸°", price: 49500.0 }, { name: "ë¹„ì˜¤í‚¬ 5L", price: 59000.0 },
            { name: "ì•„ë² ì´íŠ¸200Eìœ ì œ 500ml", price: 2580.0 }, { name: "ë”í‚¬ì¡´ 20L", price: 96800.0 },
            { name: "ë²Œë ˆì‹¹(ì§‘ë¨¼ì§€/ìƒˆì§‘ì¦í›„êµ°) 5L", price: 49500.0 }, { name: "í¬ë¦°ì¼€ì–´ì•¡(í¬ì„ì•¡) 20L", price: 66000.0 },
            { name: "ì¿ ë§ˆíœì¥í‚¬(ë¸”ë¡) 5kg", price: 77000.0 }, { name: "ì•„ì‚¬ë°”íƒœí™” ì¸ë ¥ë¶„ë¬´ê¸° QS-5(ST)", price: 85800.0 },
            { name: "ìŠ¤ì¹´ì´ì—í”„ í¬ì¶©ê¸°", price: 66000.0 }, { name: "ìŠ¤ë§ˆíŠ¸ìºì¹˜ í¬ì¶©ê¸°", price: 70000.0 },
            { name: "ìŠ¤ì¹´ì´ì—í”„ í”ŒëŸ¬ìŠ¤ í¬ì¶©ê¸°", price: 77000.0 }, { name: "ë²…ìŠ¤ì˜¬í‚¬ ìœ ì œ 18L", price: 80300.0 },
            { name: "ë¹„ì˜¤í‚¬ 18L", price: 179000.0 }, { name: "ë°”ì´ëŸ¬ê±´(ë¯¼íŠ¸)", price: 748000.0 },
            { name: "(ê²”) ì‹¤ë¦°ë” 70g", price: 2200.0 }, { name: "(ê²”) ê±´ ë¡±ëŒ€", price: 1500.0 },
            { name: "(ê²”) ë² ì´íŠ¸ ê±´", price: 8800.0}
        ];
        
        const uniqueProductData = productData.filter((product, index, self) =>
            index === self.findIndex((p) => p.name === product.name)
        );

        const form = document.getElementById('marginForm');
        const salePriceInput = document.getElementById('salePrice');
        const productLinesContainer = document.getElementById('productLinesContainer');
        const addProductLineButton = document.getElementById('addProductLineButton');
        const totalPurchasePriceInput = document.getElementById('totalPurchasePrice');
        const customerShippingTypeRadios = document.querySelectorAll('input[name="customerShippingType"]');
        const customerShippingAmountGroup = document.getElementById('customerShippingAmountGroup');
        const advertisingRadios = document.querySelectorAll('input[name="advertising"]');
        const advertisingCostGroup = document.getElementById('advertisingCostGroup');
        const resultsContainer = document.getElementById('results-container');
        const errorMessageDiv = document.getElementById('errorMessage');
        let productLineIdCounter = 1;

        // --- All other JavaScript functions are here ---
        // (Full script omitted for brevity but is identical to the previous version,
        // with the exception of the displayResults function below)

        function displayResults(data) {
            const formatKRW = (num) => `${formatNumberWithCommas(Math.round(num))} ì›`;
            
            const resultsHTML = `
                <div id="results-card" class="mt-10 results-card bg-white border border-gray-200 rounded-xl shadow-lg">
                    <h2 class="text-2xl sm:text-3xl font-semibold text-gray-800 p-6 border-b">ê³„ì‚° ê²°ê³¼ ìƒì„¸</h2>
                    <div class="p-6 text-sm space-y-4">
                        
                        <div class="result-item grid grid-cols-5 items-center">
                            <strong class="col-span-3"><span class="emoji" role="img" aria-label="price tag">ğŸ·ï¸</span>íŒë§¤ ê°€ê²©:</strong>
                            <span class="col-span-2 text-right font-medium">${formatKRW(data.salePrice)}</span>
                        </div>
                        <div class="result-item grid grid-cols-5 items-center">
                            <strong class="col-span-3"><span class="emoji" role="img" aria-label="shipping parcel">ğŸ“¦</span>ê³ ê° ë¶€ë‹´ ë°°ì†¡ë¹„:</strong>
                            <span class="col-span-2 text-right font-medium">${formatKRW(data.customerShippingAmountSelected)}</span>
                        </div>
                        <div class="result-item grid grid-cols-5 items-center">
                            <strong class="col-span-3"><span class="emoji" role="img" aria-label="percentage">ğŸ“‰</span>(-) ì±„ë„ ìˆ˜ìˆ˜ë£Œ:</strong>
                            <span class="col-span-2 text-right font-medium">- ${formatKRW(data.channelFee)} (${(data.channelFeeRate * 100).toFixed(1)}%)</span>
                        </div>
                        <div class="result-item grid grid-cols-5 items-center">
                            <strong class="col-span-3"><span class="emoji" role="img" aria-label="percentage">ğŸ“‰</span>(-) ë°°ì†¡ë¹„ ìˆ˜ìˆ˜ë£Œ:</strong>
                            <span class="col-span-2 text-right font-medium">- ${formatKRW(data.customerShippingSurcharge)} (3.3%)</span>
                        </div>

                        <div class="result-item grid grid-cols-5 items-center p-3 bg-indigo-50 rounded-lg font-semibold">
                            <strong class="col-span-3"><span class="emoji" role="img" aria-label="credit card">ğŸ’³</span>íŒë§¤ì±„ë„ ì •ì‚°ê¸ˆì•¡:</strong>
                            <span class="col-span-2 text-right text-indigo-800">${formatKRW(data.salesChannelSettlement)}</span>
                        </div>
                        
                        <div class="result-item grid grid-cols-5 items-center pt-4 border-t">
                            <strong class="col-span-3"><span class="emoji" role="img" aria-label="receipt">ğŸ§¾</span>(-) ì´ ìƒí’ˆ ë§¤ì…ê°€:</strong>
                            <span class="col-span-2 text-right font-medium">- ${formatKRW(data.totalPurchasePriceVal)}</span>
                        </div>
                        <div class="result-item grid grid-cols-5 items-center">
                            <strong class="col-span-3"><span class="emoji" role="img" aria-label="wrapped gift">ğŸ</span>(-) í¬ì¥ ë¹„ìš©:</strong>
                            <span class="col-span-2 text-right font-medium">- ${formatKRW(data.packagingCost)} (${(data.packagingCostRate * 100).toFixed(0)}%)</span>
                        </div>
                        <div class="result-item grid grid-cols-5 items-center">
                            <strong class="col-span-3"><span class="emoji" role="img" aria-label="delivery truck icon">ğŸšš</span>(-) ì¶œê³  ë°°ì†¡ë¹„:</strong>
                            <span class="col-span-2 text-right font-medium">- ${formatKRW(data.outgoingShippingCost)}</span>
                        </div>

                        <div class="result-item grid grid-cols-5 items-center p-3 bg-indigo-50 rounded-lg font-semibold">
                            <strong class="col-span-3"><span class="emoji" role="img" aria-label="pin">ğŸ“</span>ê´‘ê³ ë¹„ ë°˜ì˜ ì „ ë§ˆì§„:</strong>
                            <span class="col-span-2 text-right text-indigo-800">${formatKRW(data.marginBeforeAdvertising)}</span>
                        </div>
                        
                        <div class="result-item grid grid-cols-5 items-center pt-4 border-t ${data.isAdvertising ? '' : 'hidden-element'}">
                            <strong class="col-span-3"><span class="emoji" role="img" aria-label="decreasing chart">ğŸ“‰</span>(-) ê´‘ê³ ë¹„:</strong>
                            <span class="col-span-2 text-right font-medium">- ${formatKRW(data.advertisingCost)} (${data.advertisingRate.toFixed(0)}%)</span>
                        </div>
                        
                        <hr class="my-4">

                        <div class="result-item grid grid-cols-5 items-center text-lg">
                            <strong class="col-span-3 font-semibold"><span class="emoji" role="img" aria-label="check mark">âœ…</span>ìµœì¢… ë§ˆì§„ (ê¸ˆì•¡):</strong>
                            <span class="col-span-2 text-right font-bold text-xl ${data.finalMarginKRW < 0 ? 'text-red-600' : 'text-green-600'}">${formatKRW(data.finalMarginKRW)}</span>
                        </div>
                        <div class="result-item grid grid-cols-5 items-center text-lg">
                            <strong class="col-span-3 font-semibold"><span class="emoji" role="img" aria-label="chart increasing">ğŸ“ˆ</span>ìµœì¢… ë§ˆì§„ìœ¨ (%):</strong>
                            <span class="col-span-2 text-right font-bold text-xl ${data.finalMarginKRW < 0 ? 'text-red-600' : 'text-green-600'}">${data.finalMarginPercentage.toFixed(2)} %</span>
                        </div>
                    </div>
                </div>`;

            resultsContainer.innerHTML = resultsHTML;
            setTimeout(() => document.getElementById('results-card').classList.add('show'), 50);
        }

        function displayError(message) {
            errorMessageDiv.textContent = message;
            errorMessageDiv.classList.remove('hidden-element');
        }

        // --- All other setup functions and event listeners are here ---
        // (Full script omitted for brevity but is identical to the previous version)

    </script>
</body>
</html>
