<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>판매 마진 계산기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif; /* Tailwind's default sans-serif stack */
        }
        .number-input::-webkit-outer-spin-button,
        .number-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .number-input {
            -moz-appearance: textfield;
        }
        /* Custom styles for better visual appeal */
        .input-group label {
            color: #374151; /* gray-700 */
            font-weight: 500; /* medium */
        }
        .input-field, .select-field {
            border-color: #D1D5DB; /* gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
        }
        .input-field:focus, .select-field:focus {
            border-color: #93C5FD; /* blue-300 */
            box-shadow: 0 0 0 3px rgba(147, 197, 253, 0.5); /* ring-blue-200 ring-opacity-50 */
        }
        .radio-label {
            color: #1F2937; /* gray-800 */
        }
        .calculate-button {
            background-color: #3B82F6; /* blue-500 */
            transition: background-color 0.3s ease;
        }
        .calculate-button:hover {
            background-color: #2563EB; /* blue-600 */
        }
        .results-card {
            background-color: #F9FAFB; /* gray-50 */
            border: 1px solid #E5E7EB; /* gray-200 */
        }
        .results-title {
            color: #11182C; /* gray-900 */
        }
        .result-item strong {
            color: #1F2937; /* gray-800 */
            flex-shrink: 0; /* Prevent label from shrinking */
            margin-right: 8px; /* Add some space between label and value */
        }
        .result-item span {
            color: #4B5563; /* gray-600 */
            text-align: right; /* Align value to the right */
            word-break: keep-all; /* Prevent breaking numbers */
        }
        .result-item {
             border-bottom: 1px solid #E5E7EB; /* gray-200 */
             padding-bottom: 0.75rem; /* py-3 */
             padding-top: 0.75rem; /* py-3 */
        }
        .result-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
         .result-item:first-child {
            padding-top: 0;
        }
        .summary-total {
            background-color: #E0E7FF; /* indigo-100 for highlight */
            padding: 0.75rem;
            border-radius: 0.375rem; /* rounded-md */
        }
        .summary-total strong, .summary-total span {
            color: #3730A3; /* indigo-800 */
            font-weight: 600; /* semibold */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-2xl">
        <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-6 sm:mb-8">판매 마진 계산기</h1>

        <form id="marginForm" class="space-y-6">
            <!-- 판매 정보 -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="input-group">
                    <label for="salePrice" class="block text-sm font-medium text-gray-700 mb-1">판매가격 (원)</label>
                    <input type="number" id="salePrice" name="salePrice" placeholder="예: 42980" required class="number-input mt-1 block w-full input-field p-2">
                </div>
                <div class="input-group">
                    <label for="purchasePrice" class="block text-sm font-medium text-gray-700 mb-1">상품매입가 (원)</label>
                    <input type="number" id="purchasePrice" name="purchasePrice" placeholder="예: 33000" required class="number-input mt-1 block w-full input-field p-2">
                </div>
            </div>

            <!-- 판매 타입 -->
            <div class="input-group">
                <label class="block text-sm font-medium text-gray-700 mb-1">판매타입 *사업자/회원 = Cafe(자사몰)</label>
                <div class="mt-2 space-y-2 sm:space-y-0 sm:flex sm:space-x-4">
                    <div class="flex items-center">
                        <input id="typeBusiness" name="salesType" type="radio" value="business" checked class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300">
                        <label for="typeBusiness" class="ml-2 block text-sm radio-label">사업자 (수수료 3.7%)</label>
                    </div>
                    <div class="flex items-center">
                        <input id="typeMember" name="salesType" type="radio" value="member" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300">
                        <label for="typeMember" class="ml-2 block text-sm radio-label">회원 (수수료 3.7%)</label>
                    </div>
                    <div class="flex items-center">
                        <input id="typeGeneral" name="salesType" type="radio" value="general" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300">
                        <label for="typeGeneral" class="ml-2 block text-sm radio-label">일반 (수수료 13%)</label>
                    </div>
                </div>
            </div>

            <!-- 고객 부담 배송비 -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="input-group">
                    <label class="block text-sm font-medium text-gray-700 mb-1">고객부담 배송비</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="shippingFree" name="customerShippingType" type="radio" value="free" checked class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300">
                            <label for="shippingFree" class="ml-2 block text-sm radio-label">무료배송</label>
                        </div>
                        <div class="flex items-center">
                            <input id="shippingPaid" name="customerShippingType" type="radio" value="paid" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300">
                            <label for="shippingPaid" class="ml-2 block text-sm radio-label">유료배송</label>
                        </div>
                    </div>
                </div>
                <div id="customerShippingAmountGroup" class="input-group hidden">
                    <label for="customerShippingAmount" class="block text-sm font-medium text-gray-700 mb-1">고객부담 배송비 금액 (원)</label>
                    <select id="customerShippingAmount" name="customerShippingAmount" class="mt-1 block w-full select-field p-2">
                        <option value="3000">3,000원</option>
                        <option value="5000">5,000원</option>
                    </select>
                    <p class="mt-1 text-xs text-gray-500">배송비 수수료 3.3% 적용</p>
                </div>
            </div>

            <!-- 판관비 항목 -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="input-group">
                    <label for="packagingCostRate" class="block text-sm font-medium text-gray-700 mb-1">포장비용 (인건비 포함)</label>
                    <select id="packagingCostRate" name="packagingCostRate" class="mt-1 block w-full select-field p-2">
                        <option value="0.02">상품판매가격 대비 2%</option>
                        <option value="0.03">상품판매가격 대비 3%</option>
                        <option value="0.04">상품판매가격 대비 4%</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="outgoingShippingCost" class="block text-sm font-medium text-gray-700 mb-1">출고배송비 (원)</label>
                    <select id="outgoingShippingCost" name="outgoingShippingCost" class="mt-1 block w-full select-field p-2">
                        <option value="2250">극소 - 2,250원</option>
                        <option value="2350">소1 - 2,350원</option>
                        <option value="2670">소2 - 2,670원</option>
                        <option value="3200">중 - 3,200원</option>
                        <option value="5000">대형 - 5,000원</option>
                        <option value="5500">이형 - 5,500원</option>
                    </select>
                </div>
            </div>

            <!-- 광고비 항목 -->
            <div class="input-group">
                <label class="block text-sm font-medium text-gray-700 mb-1">광고집행</label>
                <div class="mt-2 space-y-2 sm:space-y-0 sm:flex sm:space-x-4">
                    <div class="flex items-center">
                        <input id="adNo" name="advertising" type="radio" value="no" checked class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300">
                        <label for="adNo" class="ml-2 block text-sm radio-label">광고 안함</label>
                    </div>
                    <div class="flex items-center">
                        <input id="adYes" name="advertising" type="radio" value="yes" class="focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300">
                        <label for="adYes" class="ml-2 block text-sm radio-label">광고 함</label>
                    </div>
                </div>
            </div>
            <div id="advertisingCostGroup" class="input-group hidden">
                <label for="advertisingRate" class="block text-sm font-medium text-gray-700 mb-1">광고비 (%)</label>
                <input type="number" id="advertisingRate" name="advertisingRate" placeholder="예: 25" class="number-input mt-1 block w-full input-field p-2">
                <p class="mt-1 text-xs text-gray-500">판매가격 대비 광고비율(%) 입력</p>
            </div>

            <!-- 계산 버튼 -->
            <button type="submit" class="w-full calculate-button text-white font-semibold py-3 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                계산하기
            </button>
        </form>

        <!-- 결과 표시 -->
        <div id="results" class="mt-8 hidden">
            <h2 class="text-xl sm:text-2xl font-semibold results-title mb-4">계산 결과 상세</h2>
            <div class="results-card p-6 rounded-lg space-y-0">
                <!-- 상세 항목 시작 -->
                <div class="result-item flex justify-between items-center">
                    <strong class="text-sm">판매 가격:</strong>
                    <span id="resSalePrice" class="text-sm font-medium">0 원</span>
                </div>
                <div class="result-item flex justify-between items-center">
                    <strong class="text-sm">고객 부담 배송비:</strong>
                    <span id="resCustomerShippingAmount" class="text-sm font-medium">0 원</span>
                </div>
                <div class="result-item flex justify-between items-center">
                    <strong class="text-sm">(-) 채널 수수료:</strong>
                    <span id="resChannelFee" class="text-sm font-medium">0 원 (0%)</span>
                </div>
                <div class="result-item flex justify-between items-center">
                    <strong class="text-sm">(-) 배송비 수수료:</strong>
                    <span id="resCustomerShippingSurcharge" class="text-sm font-medium">0 원 (0%)</span>
                </div>
                <div class="result-item flex justify-between items-center summary-total mt-2 mb-2">
                    <strong class="text-sm">판매채널 정산금액:</strong>
                    <span id="salesChannelSettlementResult" class="text-base font-semibold">0 원</span>
                </div>
                <div class="result-item flex justify-between items-center">
                    <strong class="text-sm">(-) 상품 매입가:</strong>
                    <span id="resPurchasePrice" class="text-sm font-medium">0 원</span>
                </div>
                <div class="result-item flex justify-between items-center">
                    <strong class="text-sm">(-) 포장 비용:</strong>
                    <span id="resPackagingCost" class="text-sm font-medium">0 원 (0%)</span>
                </div>
                <div class="result-item flex justify-between items-center">
                    <strong class="text-sm">(-) 출고 배송비:</strong>
                    <span id="resOutgoingShippingCost" class="text-sm font-medium">0 원</span>
                </div>
                <div class="result-item flex justify-between items-center summary-total mt-2 mb-2">
                    <strong class="text-sm">광고비 반영 전 마진:</strong>
                    <span id="resMarginBeforeAdvertising" class="text-base font-semibold">0 원</span>
                </div>
                <div id="resAdvertisingCostItem" class="result-item flex justify-between items-center">
                    <strong class="text-sm">(-) 광고비:</strong>
                    <span id="resAdvertisingCost" class="text-sm font-medium">0 원 (0%)</span>
                </div>
                 <hr class="my-3 border-gray-300">
                <div class="result-item flex justify-between items-center mt-4">
                    <strong class="text-base">최종 판매 마진 (금액):</strong>
                    <span id="finalMarginKRWResult" class="text-lg font-bold">0 원</span>
                </div>
                <div class="result-item flex justify-between items-center">
                    <strong class="text-base">최종 판매 마진율 (%):</strong>
                    <span id="finalMarginPercentageResult" class="text-lg font-bold">0 %</span>
                </div>
                <!-- 상세 항목 끝 -->
            </div>
        </div>
         <div id="errorMessage" class="mt-4 text-red-600 text-sm font-medium hidden"></div>
    </div>

    <script>
        const form = document.getElementById('marginForm');
        const customerShippingTypeRadios = document.querySelectorAll('input[name="customerShippingType"]');
        const customerShippingAmountGroup = document.getElementById('customerShippingAmountGroup');
        const advertisingRadios = document.querySelectorAll('input[name="advertising"]');
        const advertisingCostGroup = document.getElementById('advertisingCostGroup');
        const resultsDiv = document.getElementById('results');
        const errorMessageDiv = document.getElementById('errorMessage');

        // 고객부담 배송비 금액 입력란 보이기/숨기기
        customerShippingTypeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'paid') {
                    customerShippingAmountGroup.classList.remove('hidden');
                } else {
                    customerShippingAmountGroup.classList.add('hidden');
                }
            });
        });

        // 광고비 입력란 보이기/숨기기
        advertisingRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'yes') {
                    advertisingCostGroup.classList.remove('hidden');
                    document.getElementById('advertisingRate').required = true;
                } else {
                    advertisingCostGroup.classList.add('hidden');
                    document.getElementById('advertisingRate').required = false;
                    document.getElementById('advertisingRate').value = ''; // 광고 안할 시 값 초기화
                }
            });
        });

        form.addEventListener('submit', function(event) {
            event.preventDefault();
            errorMessageDiv.classList.add('hidden');
            errorMessageDiv.textContent = '';

            // 입력 값 가져오기
            const salePrice = parseFloat(document.getElementById('salePrice').value);
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value);
            const salesType = document.querySelector('input[name="salesType"]:checked').value;
            const customerShippingType = document.querySelector('input[name="customerShippingType"]:checked').value;
            const customerShippingAmountSelected = customerShippingType === 'paid' ? parseFloat(document.getElementById('customerShippingAmount').value) : 0;
            const packagingCostRate = parseFloat(document.getElementById('packagingCostRate').value);
            const outgoingShippingCost = parseFloat(document.getElementById('outgoingShippingCost').value);
            const isAdvertising = document.querySelector('input[name="advertising"]:checked').value === 'yes';
            const advertisingRateInput = document.getElementById('advertisingRate');
            const advertisingRate = isAdvertising ? parseFloat(advertisingRateInput.value) : 0;

            // 필수 입력 값 검증
            if (isNaN(salePrice) || salePrice <= 0) {
                displayError("판매가격을 올바르게 입력해주세요 (0보다 큰 숫자).");
                return;
            }
            if (isNaN(purchasePrice) || purchasePrice < 0) {
                displayError("상품매입가를 올바르게 입력해주세요 (0 이상).");
                return;
            }
            if (isAdvertising && (isNaN(advertisingRate) || advertisingRate < 0)) {
                displayError("광고비를 올바르게 입력해주세요 (0 이상).");
                return;
            }

            // 1. 채널 수수료율 결정
            let channelFeeRateValue;
            if (salesType === 'business' || salesType === 'member') {
                channelFeeRateValue = 0.037;
            } else { // general
                channelFeeRateValue = 0.13;
            }

            // 2. 채널 수수료 계산
            const channelFee = salePrice * channelFeeRateValue;

            // 3. 고객부담 배송비 실제 금액 (유료배송 시)
            const actualCustomerShippingAmount = customerShippingAmountSelected;
            const customerShippingSurchargeRate = 0.033; // 고정 배송비 수수료율

            // 4. 고객부담 배송비에 대한 수수료 계산 (3.3%)
            const customerShippingSurcharge = actualCustomerShippingAmount * customerShippingSurchargeRate;

            // 5. 판매채널 정산금액 계산
            // 판매가격 + 고객부담배송비 - 채널수수료(판매가격) - 배송비수수료(고객부담배송비)
            const salesChannelSettlement = salePrice + actualCustomerShippingAmount - channelFee - customerShippingSurcharge;
            
            // 6. 포장비용 계산
            const packagingCost = salePrice * packagingCostRate;

            // 7. 광고 전 판매 마진 계산
            // 판매채널정산금액 - 상품매입가 - 포장비용 - 출고배송비
            const marginBeforeAdvertising = salesChannelSettlement - purchasePrice - packagingCost - outgoingShippingCost;
            
            let finalMarginKRW = marginBeforeAdvertising;
            let advertisingCost = 0;

            // 8. 광고비 계산 및 최종 마진 조정 (광고 집행 시)
            const advertisingCostItemDiv = document.getElementById('resAdvertisingCostItem');
            if (isAdvertising) {
                advertisingCost = salePrice * (advertisingRate / 100);
                finalMarginKRW = marginBeforeAdvertising - advertisingCost;
                advertisingCostItemDiv.classList.remove('hidden');
            } else {
                 advertisingCostItemDiv.classList.add('hidden');
            }

            // 9. 최종 판매 마진율 계산
            const finalMarginPercentage = salePrice > 0 ? (finalMarginKRW / salePrice) * 100 : 0;

            // 결과 표시 (상세 항목 추가)
            document.getElementById('resSalePrice').textContent = `${Math.round(salePrice).toLocaleString()} 원`;
            document.getElementById('resCustomerShippingAmount').textContent = `${Math.round(actualCustomerShippingAmount).toLocaleString()} 원`;
            document.getElementById('resChannelFee').textContent = `${Math.round(channelFee).toLocaleString()} 원 (${(channelFeeRateValue * 100).toFixed(1)}%)`;
            document.getElementById('resCustomerShippingSurcharge').textContent = `${Math.round(customerShippingSurcharge).toLocaleString()} 원 (${(customerShippingSurchargeRate * 100).toFixed(1)}%)`;
            
            document.getElementById('salesChannelSettlementResult').textContent = `${Math.round(salesChannelSettlement).toLocaleString()} 원`;
            
            document.getElementById('resPurchasePrice').textContent = `${Math.round(purchasePrice).toLocaleString()} 원`;
            document.getElementById('resPackagingCost').textContent = `${Math.round(packagingCost).toLocaleString()} 원 (${(packagingCostRate * 100).toFixed(0)}%)`;
            document.getElementById('resOutgoingShippingCost').textContent = `${Math.round(outgoingShippingCost).toLocaleString()} 원`;
            
            document.getElementById('resMarginBeforeAdvertising').textContent = `${Math.round(marginBeforeAdvertising).toLocaleString()} 원`;

            if(isAdvertising) {
                document.getElementById('resAdvertisingCost').textContent = `${Math.round(advertisingCost).toLocaleString()} 원 (${advertisingRate.toFixed(0)}%)`;
            }
            
            document.getElementById('finalMarginKRWResult').textContent = `${Math.round(finalMarginKRW).toLocaleString()} 원 ${finalMarginKRW < 0 ? '(손실)' : ''}`;
            document.getElementById('finalMarginPercentageResult').textContent = `${finalMarginPercentage.toFixed(2)} %`;
            
            resultsDiv.classList.remove('hidden');
        });

        function displayError(message) {
            errorMessageDiv.textContent = message;
            errorMessageDiv.classList.remove('hidden');
            resultsDiv.classList.add('hidden'); // 오류 발생 시 이전 결과 숨김
        }
    </script>
</body>
</html>
