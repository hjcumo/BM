<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒë§¤ ë§ˆì§„ ê³„ì‚°ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif; /* Noto Sans KR ì¶”ê°€ */
        }
        .number-input::-webkit-outer-spin-button,
        .number-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .number-input {
            -moz-appearance: textfield;
        }
        
        /* ì „ì²´ ì»¨í…Œì´ë„ˆ */
        .calculator-container {
            transition: all 0.3s ease-in-out;
        }

        /* ì…ë ¥ ê·¸ë£¹ */
        .input-group label {
            color: #4A5568; /* gray-700 (ì¡°ê¸ˆ ë” ë¶€ë“œëŸ½ê²Œ) */
            font-weight: 500; 
            display: flex; /* ì´ëª¨ì§€ì™€ í…ìŠ¤íŠ¸ ì •ë ¬ */
            align-items: center;
        }
        .input-group label .emoji {
            margin-right: 0.5rem; /* ì´ëª¨ì§€ì™€ í…ìŠ¤íŠ¸ ê°„ê²© */
            font-size: 1.1em;
        }

        .input-field, .select-field {
            border-color: #E2E8F0; /* gray-300 (ì¡°ê¸ˆ ë” ë¶€ë“œëŸ½ê²Œ) */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 0.75rem 1rem; /* p-3ì—ì„œ p-4 ì •ë„ë¡œ í‚¤ì›€ */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.07), 0 1px 2px 0 rgba(0, 0, 0, 0.04); /* shadow-md */
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .input-field:focus, .select-field:focus {
            border-color: #6366F1; /* indigo-500 */
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3); /* ring-indigo-300 ring-opacity-30 */
            outline: none;
        }

        .radio-label {
            color: #2D3748; /* gray-800 (ì¡°ê¸ˆ ë” ì§„í•˜ê²Œ) */
            transition: color 0.2s ease;
        }
        input[type="radio"]:checked + .radio-label {
            color: #4F46E5; /* indigo-600 */
        }
        input[type="radio"] {
            transition: all 0.2s ease;
        }
        input[type="radio"]:focus {
            ring-offset-color: white; /* í¬ì»¤ìŠ¤ ë§ ì˜¤í”„ì…‹ ìƒ‰ìƒ */
        }


        /* ë²„íŠ¼ */
        .calculate-button {
            background-color: #4F46E5; /* indigo-600 */
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* semibold */
            padding: 0.875rem 1.5rem; /* py-3.5 px-6 */
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .calculate-button:hover {
            background-color: #4338CA; /* indigo-700 */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .calculate-button:active {
            transform: translateY(1px);
            background-color: #3730A3; /* indigo-800 */
        }

        /* ê²°ê³¼ ì„¹ì…˜ */
        .results-card {
            background-color: white;
            border: 1px solid #E2E8F0; /* gray-200 */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.03); /* shadow-lg */
            opacity: 0; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
            transform: translateY(20px); /* ì•„ë˜ì—ì„œ ë‚˜íƒ€ë‚˜ëŠ” íš¨ê³¼ */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .results-card.show {
            opacity: 1;
            transform: translateY(0);
        }

        .results-title {
            color: #1A202C; /* gray-900 */
            border-bottom: 1px solid #E2E8F0;
            padding-bottom: 0.75rem;
        }
        .result-item {
             border-bottom: 1px dashed #E2E8F0; /* êµ¬ë¶„ì„  ì ì„ ìœ¼ë¡œ ë³€ê²½ */
             padding: 1rem 0.5rem; /* ìƒí•˜ íŒ¨ë”© ì¦ê°€, ì¢Œìš° íŒ¨ë”© ì•½ê°„ ê°ì†Œ */
             transition: background-color 0.2s ease;
        }
        .result-item:hover {
            background-color: #F7FAFC; /* gray-100 ì•„ì£¼ ì—°í•˜ê²Œ */
        }
        .result-item strong {
            color: #2D3748; /* gray-800 */
            font-weight: 500; /* medium */
            display: flex;
            align-items: center;
        }
        .result-item strong .emoji {
            margin-right: 0.5rem;
            font-size: 1em;
        }
        .result-item span {
            color: #4A5568; /* gray-700 */
            font-weight: 500;
        }
        .result-item:last-child {
            border-bottom: none;
        }
        .result-item:first-child {
            padding-top: 0.5rem; /* ì²« í•­ëª© ìƒë‹¨ íŒ¨ë”© ì¡°ì • */
        }

        /* ì¤‘ê°„ í•©ê³„ ê°•ì¡° */
        .summary-total {
            background-color: #EEF2FF; /* indigo-50 */
            padding: 1rem;
            border-radius: 0.5rem; /* rounded-lg */
            margin-top: 0.5rem !important;
            margin-bottom: 0.5rem !important;
            border-left: 4px solid #6366F1; /* indigo-500 */
        }
        .summary-total strong, .summary-total span {
            color: #3730A3; /* indigo-800 */
            font-weight: 600; /* semibold */
        }
        
        /* ìµœì¢… ë§ˆì§„ ê°•ì¡° */
        #finalMarginKRWResult.loss, #finalMarginPercentageResult.loss {
            color: #E53E3E; /* red-600 */
        }
        #finalMarginKRWResult.profit, #finalMarginPercentageResult.profit {
            color: #38A169; /* green-600 */
        }

        .final-summary-item strong{
            font-size: 1.125rem; /* text-lg */
        }
        .final-summary-item span{
            font-size: 1.25rem; /* text-xl */
        }

        /* ì—ëŸ¬ ë©”ì‹œì§€ */
        .error-message {
            background-color: #FFF5F5; /* red-50 */
            color: #C53030; /* red-700 */
            border: 1px solid #FC8181; /* red-300 */
            border-left-width: 4px;
            border-left-color: #E53E3E; /* red-600 */
            padding: 1rem;
            border-radius: 0.375rem; /* rounded-md */
            transition: opacity 0.3s ease;
        }
         .hidden {
            display: none !important; /* Tailwind hiddenì„ í™•ì‹¤íˆ ì˜¤ë²„ë¼ì´ë“œ */
        }

    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="bg-white p-6 sm:p-10 rounded-xl shadow-2xl w-full max-w-3xl calculator-container"> <!-- max-width ì¦ê°€ -->
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-8 sm:mb-10">
            <span class="emoji" role="img" aria-label="calculator">ğŸœ</span> HBíŒë§¤ ë§ˆì§„ ê³„ì‚°ê¸°
        </h1>

        <form id="marginForm" class="space-y-8"> <!-- space-y ì¦ê°€ -->
            <!-- íŒë§¤ ì •ë³´ -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6">
                <div class="input-group">
                    <label for="salePrice" class="block text-sm font-medium text-gray-700 mb-2"><span class="emoji" role="img" aria-label="money bag">ğŸ’°</span>íŒë§¤ê°€ê²© (ì›)</label>
                    <input type="number" id="salePrice" name="salePrice" placeholder="ì˜ˆ: 42980" required class="number-input mt-1 block w-full input-field">
                </div>
                <div class="input-group">
                    <label for="purchasePrice" class="block text-sm font-medium text-gray-700 mb-2"><span class="emoji" role="img" aria-label="shopping cart">ğŸ›’</span>ìƒí’ˆë§¤ì…ê°€ (ì›)</label>
                    <input type="number" id="purchasePrice" name="purchasePrice" placeholder="ì˜ˆ: 33000" required class="number-input mt-1 block w-full input-field">
                </div>
            </div>

            <!-- íŒë§¤ íƒ€ì… -->
            <div class="input-group">
                <label class="block text-sm font-medium text-gray-700 mb-2"><span class="emoji" role="img" aria-label="briefcase">ğŸ§‘â€ğŸ’¼</span>íŒë§¤íƒ€ì… (*ì‚¬ì—…ì,íšŒì›=>Cafe24 ìì‚¬ëª°)</label>
                <div class="mt-2 space-y-2 sm:space-y-0 sm:flex sm:space-x-6"> <!-- space-x ì¦ê°€ -->
                    <div class="flex items-center">
                        <input id="typeBusiness" name="salesType" type="radio" value="business" checked class="focus:ring-indigo-500 h-5 w-5 text-indigo-600 border-gray-300">
                        <label for="typeBusiness" class="ml-2 block text-sm radio-label">ì‚¬ì—…ì (3.7%)</label>
                    </div>
                    <div class="flex items-center">
                        <input id="typeMember" name="salesType" type="radio" value="member" class="focus:ring-indigo-500 h-5 w-5 text-indigo-600 border-gray-300">
                        <label for="typeMember" class="ml-2 block text-sm radio-label">íšŒì› (3.7%)</label>
                    </div>
                    <div class="flex items-center">
                        <input id="typeGeneral" name="salesType" type="radio" value="general" class="focus:ring-indigo-500 h-5 w-5 text-indigo-600 border-gray-300">
                        <label for="typeGeneral" class="ml-2 block text-sm radio-label">ì¼ë°˜ (13%)</label>
                    </div>
                </div>
            </div>

            <!-- ê³ ê° ë¶€ë‹´ ë°°ì†¡ë¹„ -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6 items-start"> <!-- items-start ì¶”ê°€ -->
                <div class="input-group">
                    <label class="block text-sm font-medium text-gray-700 mb-2"><span class="emoji" role="img" aria-label="delivery truck">ğŸšš</span>ê³ ê°ë¶€ë‹´ ë°°ì†¡ë¹„</label>
                    <div class="mt-2 space-y-2">
                        <div class="flex items-center">
                            <input id="shippingFree" name="customerShippingType" type="radio" value="free" checked class="focus:ring-indigo-500 h-5 w-5 text-indigo-600 border-gray-300">
                            <label for="shippingFree" class="ml-2 block text-sm radio-label">ë¬´ë£Œë°°ì†¡</label>
                        </div>
                        <div class="flex items-center">
                            <input id="shippingPaid" name="customerShippingType" type="radio" value="paid" class="focus:ring-indigo-500 h-5 w-5 text-indigo-600 border-gray-300">
                            <label for="shippingPaid" class="ml-2 block text-sm radio-label">ìœ ë£Œë°°ì†¡</label>
                        </div>
                    </div>
                </div>
                <div id="customerShippingAmountGroup" class="input-group hidden">
                    <label for="customerShippingAmount" class="block text-sm font-medium text-gray-700 mb-2"><span class="emoji" role="img" aria-label="package">ğŸ“¦</span>ê³ ê°ë¶€ë‹´ ë°°ì†¡ë¹„ ê¸ˆì•¡ (ì›)</label>
                    <select id="customerShippingAmount" name="customerShippingAmount" class="mt-1 block w-full select-field">
                        <option value="3000">3,000ì›</option>
                        <option value="5000">5,000ì›</option>
                    </select>
                    <p class="mt-1 text-xs text-gray-500">ë°°ì†¡ë¹„ ìˆ˜ìˆ˜ë£Œ 3.3% ì ìš©</p>
                </div>
            </div>

            <!-- íŒê´€ë¹„ í•­ëª© -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6">
                <div class="input-group">
                    <label for="packagingCostRate" class="block text-sm font-medium text-gray-700 mb-2"><span class="emoji" role="img" aria-label="gift">ğŸ</span>í¬ì¥ë¹„ìš© (ì¸ê±´ë¹„ í¬í•¨)</label>
                    <select id="packagingCostRate" name="packagingCostRate" class="mt-1 block w-full select-field">
                        <option value="0.02">ìƒí’ˆíŒë§¤ê°€ê²© ëŒ€ë¹„ 2%</option>
                        <option value="0.03">ìƒí’ˆíŒë§¤ê°€ê²© ëŒ€ë¹„ 3%</option>
                        <option value="0.04">ìƒí’ˆíŒë§¤ê°€ê²© ëŒ€ë¹„ 4%</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="outgoingShippingCost" class="block text-sm font-medium text-gray-700 mb-2"><span class="emoji" role="img" aria-label="shipping box">ğŸš›</span>ì¶œê³ ë°°ì†¡ë¹„ (ì›)</label>
                    <select id="outgoingShippingCost" name="outgoingShippingCost" class="mt-1 block w-full select-field">
                        <option value="2250">ê·¹ì†Œ - 2,250ì›</option>
                        <option value="2350">ì†Œ1 - 2,350ì›</option>
                        <option value="2670">ì†Œ2 - 2,670ì›</option>
                        <option value="3200">ì¤‘ - 3,200ì›</option>
                        <option value="5000">ëŒ€í˜• - 5,000ì›</option>
                        <option value="5500">ì´í˜• - 5,500ì›</option>
                    </select>
                </div>
            </div>

            <!-- ê´‘ê³ ë¹„ í•­ëª© -->
            <div class="input-group">
                <label class="block text-sm font-medium text-gray-700 mb-2"><span class="emoji" role="img" aria-label="megaphone">ğŸ“¢</span>ê´‘ê³ ì§‘í–‰</label>
                 <div class="mt-2 space-y-2 sm:space-y-0 sm:flex sm:space-x-6">
                    <div class="flex items-center">
                        <input id="adNo" name="advertising" type="radio" value="no" checked class="focus:ring-indigo-500 h-5 w-5 text-indigo-600 border-gray-300">
                        <label for="adNo" class="ml-2 block text-sm radio-label">ê´‘ê³  ì•ˆí•¨</label>
                    </div>
                    <div class="flex items-center">
                        <input id="adYes" name="advertising" type="radio" value="yes" class="focus:ring-indigo-500 h-5 w-5 text-indigo-600 border-gray-300">
                        <label for="adYes" class="ml-2 block text-sm radio-label">ê´‘ê³  í•¨</label>
                    </div>
                </div>
            </div>
            <div id="advertisingCostGroup" class="input-group hidden">
                <label for="advertisingRate" class="block text-sm font-medium text-gray-700 mb-2"><span class="emoji" role="img" aria-label="bar chart">ğŸ“Š</span>ê´‘ê³ ë¹„ (%)</label>
                <input type="number" id="advertisingRate" name="advertisingRate" placeholder="ì˜ˆ: 25" class="number-input mt-1 block w-full input-field">
                <p class="mt-1 text-xs text-gray-500">íŒë§¤ê°€ê²© ëŒ€ë¹„ ê´‘ê³ ë¹„ìœ¨(%) ì…ë ¥</p>
            </div>

            <!-- ê³„ì‚° ë²„íŠ¼ -->
            <button type="submit" class="w-full calculate-button text-white">
                ê³„ì‚°í•˜ê¸°
            </button>
        </form>

        <!-- ê²°ê³¼ í‘œì‹œ -->
        <div id="results" class="mt-10 results-card"> <!-- mt ì¦ê°€ -->
            <h2 class="text-2xl sm:text-3xl font-semibold results-title mb-6 p-6">ê³„ì‚° ê²°ê³¼ ìƒì„¸</h2> <!-- íŒ¨ë”© ì¶”ê°€ -->
            <div class="p-6 pt-0 space-y-0"> <!-- ë‚´ë¶€ íŒ¨ë”© ì¡°ì • -->
                <!-- ìƒì„¸ í•­ëª© ì‹œì‘ -->
                <div class="result-item flex justify-between items-center">
                    <strong class="text-sm"><span class="emoji" role="img" aria-label="price tag">ğŸ·ï¸</span>íŒë§¤ ê°€ê²©:</strong>
                    <span id="resSalePrice" class="text-sm font-medium">0 ì›</span>
                </div>
                <div class="result-item flex justify-between items-center">
                    <strong class="text-sm"><span class="emoji" role="img" aria-label="shipping parcel">ğŸ“¦</span>ê³ ê° ë¶€ë‹´ ë°°ì†¡ë¹„:</strong>
                    <span id="resCustomerShippingAmount" class="text-sm font-medium">0 ì›</span>
                </div>
                <div class="result-item flex justify-between items-center">
                    <strong class="text-sm"><span class="emoji" role="img" aria-label="percentage">ğŸ“‰</span>(-) ì±„ë„ ìˆ˜ìˆ˜ë£Œ:</strong>
                    <span id="resChannelFee" class="text-sm font-medium">0 ì› (0%)</span>
                </div>
                <div class="result-item flex justify-between items-center">
                    <strong class="text-sm"><span class="emoji" role="img" aria-label="percentage">ğŸ“‰</span>(-) ë°°ì†¡ë¹„ ìˆ˜ìˆ˜ë£Œ:</strong>
                    <span id="resCustomerShippingSurcharge" class="text-sm font-medium">0 ì› (0%)</span>
                </div>
                <div class="result-item flex justify-between items-center summary-total">
                    <strong class="text-sm"><span class="emoji" role="img" aria-label="credit card">ğŸ’³</span>íŒë§¤ì±„ë„ ì •ì‚°ê¸ˆì•¡:</strong>
                    <span id="salesChannelSettlementResult" class="text-base font-semibold">0 ì›</span>
                </div>
                <div class="result-item flex justify-between items-center">
                    <strong class="text-sm"><span class="emoji" role="img" aria-label="receipt">ğŸ§¾</span>(-) ìƒí’ˆ ë§¤ì…ê°€:</strong>
                    <span id="resPurchasePrice" class="text-sm font-medium">0 ì›</span>
                </div>
                <div class="result-item flex justify-between items-center">
                    <strong class="text-sm"><span class="emoji" role="img" aria-label="wrapped gift">ğŸ</span>(-) í¬ì¥ ë¹„ìš©:</strong>
                    <span id="resPackagingCost" class="text-sm font-medium">0 ì› (0%)</span>
                </div>
                <div class="result-item flex justify-between items-center">
                    <strong class="text-sm"><span class="emoji" role="img" aria-label="delivery truck icon">ğŸšš</span>(-) ì¶œê³  ë°°ì†¡ë¹„:</strong>
                    <span id="resOutgoingShippingCost" class="text-sm font-medium">0 ì›</span>
                </div>
                <div class="result-item flex justify-between items-center summary-total">
                    <strong class="text-sm"><span class="emoji" role="img" aria-label="piggy bank">ğŸ–</span>ê´‘ê³ ë¹„ ë°˜ì˜ ì „ ë§ˆì§„:</strong>
                    <span id="resMarginBeforeAdvertising" class="text-base font-semibold">0 ì›</span>
                </div>
                <div id="resAdvertisingCostItem" class="result-item flex justify-between items-center">
                    <strong class="text-sm"><span class="emoji" role="img" aria-label="decreasing chart">ğŸ“‰</span>(-) ê´‘ê³ ë¹„:</strong>
                    <span id="resAdvertisingCost" class="text-sm font-medium">0 ì› (0%)</span>
                </div>
                 <hr class="my-4 border-gray-300"> <!-- my ì¦ê°€ -->
                <div class="result-item flex justify-between items-center mt-4 final-summary-item">
                    <strong class="text-base"><span class="emoji" role="img" aria-label="check mark">âœ…</span>ìµœì¢… íŒë§¤ ë§ˆì§„ (ê¸ˆì•¡):</strong>
                    <span id="finalMarginKRWResult" class="font-bold">0 ì›</span>
                </div>
                <div class="result-item flex justify-between items-center final-summary-item">
                    <strong class="text-base"><span class="emoji" role="img" aria-label="chart increasing">ğŸ“ˆ</span>ìµœì¢… íŒë§¤ ë§ˆì§„ìœ¨ (%):</strong>
                    <span id="finalMarginPercentageResult" class="font-bold">0 %</span>
                </div>
                <!-- ìƒì„¸ í•­ëª© ë -->
            </div>
        </div>
         <div id="errorMessage" class="mt-6 error-message hidden"></div> <!-- mt ì¦ê°€ ë° ìŠ¤íƒ€ì¼ í´ë˜ìŠ¤ ì ìš© -->
    </div>

    <script>
        const form = document.getElementById('marginForm');
        const customerShippingTypeRadios = document.querySelectorAll('input[name="customerShippingType"]');
        const customerShippingAmountGroup = document.getElementById('customerShippingAmountGroup');
        const advertisingRadios = document.querySelectorAll('input[name="advertising"]');
        const advertisingCostGroup = document.getElementById('advertisingCostGroup');
        const resultsDiv = document.getElementById('results');
        const errorMessageDiv = document.getElementById('errorMessage');

        // ê³ ê°ë¶€ë‹´ ë°°ì†¡ë¹„ ê¸ˆì•¡ ì…ë ¥ë€ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°
        customerShippingTypeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'paid') {
                    customerShippingAmountGroup.classList.remove('hidden');
                    customerShippingAmountGroup.classList.add('opacity-100', 'transform', 'translate-y-0'); // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
                } else {
                    customerShippingAmountGroup.classList.add('hidden');
                    customerShippingAmountGroup.classList.remove('opacity-100', 'transform', 'translate-y-0');
                }
            });
        });

        // ê´‘ê³ ë¹„ ì…ë ¥ë€ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°
        advertisingRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'yes') {
                    advertisingCostGroup.classList.remove('hidden');
                    advertisingCostGroup.classList.add('opacity-100', 'transform', 'translate-y-0');
                    document.getElementById('advertisingRate').required = true;
                } else {
                    advertisingCostGroup.classList.add('hidden');
                    advertisingCostGroup.classList.remove('opacity-100', 'transform', 'translate-y-0');
                    document.getElementById('advertisingRate').required = false;
                    document.getElementById('advertisingRate').value = '';
                }
            });
        });
        // ì´ˆê¸° hidden í´ë˜ìŠ¤ê°€ ìˆëŠ” ìš”ì†Œì— ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ í´ë˜ìŠ¤ ì¶”ê°€
        [customerShippingAmountGroup, advertisingCostGroup].forEach(el => {
            if(el.classList.contains('hidden')) {
                el.classList.add('opacity-0', 'transform', '-translate-y-2', 'transition-all', 'duration-300', 'ease-out');
            }
        });


        form.addEventListener('submit', function(event) {
            event.preventDefault();
            errorMessageDiv.classList.add('hidden'); // ì´ì „ ì—ëŸ¬ ë©”ì‹œì§€ ìˆ¨ê¹€
            errorMessageDiv.textContent = '';
             // ê²°ê³¼ ì¹´ë“œ ìˆ¨ê²¼ë‹¤ê°€ ë‹¤ì‹œ ë³´ì´ê²Œ í•´ì„œ ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±°
            resultsDiv.classList.remove('show');


            // ì…ë ¥ ê°’ ê°€ì ¸ì˜¤ê¸°
            const salePrice = parseFloat(document.getElementById('salePrice').value);
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value);
            const salesType = document.querySelector('input[name="salesType"]:checked').value;
            const customerShippingType = document.querySelector('input[name="customerShippingType"]:checked').value;
            const customerShippingAmountSelected = customerShippingType === 'paid' ? parseFloat(document.getElementById('customerShippingAmount').value) : 0;
            const packagingCostRate = parseFloat(document.getElementById('packagingCostRate').value);
            const outgoingShippingCost = parseFloat(document.getElementById('outgoingShippingCost').value);
            const isAdvertising = document.querySelector('input[name="advertising"]:checked').value === 'yes';
            const advertisingRateInput = document.getElementById('advertisingRate');
            const advertisingRate = isAdvertising ? parseFloat(advertisingRateInput.value) : 0;

            // í•„ìˆ˜ ì…ë ¥ ê°’ ê²€ì¦
            if (isNaN(salePrice) || salePrice <= 0) {
                displayError("ğŸ’° íŒë§¤ê°€ê²©ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš” (0ë³´ë‹¤ í° ìˆ«ì).");
                return;
            }
            if (isNaN(purchasePrice) || purchasePrice < 0) { // ë§¤ì…ê°€ëŠ” 0ì¼ ìˆ˜ë„ ìˆìŒ
                displayError("ğŸ›’ ìƒí’ˆë§¤ì…ê°€ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš” (0 ì´ìƒ).");
                return;
            }
            if (isAdvertising && (isNaN(advertisingRate) || advertisingRate < 0)) {
                displayError("ğŸ“Š ê´‘ê³ ë¹„ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš” (0 ì´ìƒ).");
                return;
            }

            // 1. ì±„ë„ ìˆ˜ìˆ˜ë£Œìœ¨ ê²°ì •
            let channelFeeRateValue;
            if (salesType === 'business' || salesType === 'member') {
                channelFeeRateValue = 0.037;
            } else { // general
                channelFeeRateValue = 0.13;
            }

            // 2. ì±„ë„ ìˆ˜ìˆ˜ë£Œ ê³„ì‚°
            const channelFee = salePrice * channelFeeRateValue;

            // 3. ê³ ê°ë¶€ë‹´ ë°°ì†¡ë¹„ ì‹¤ì œ ê¸ˆì•¡ (ìœ ë£Œë°°ì†¡ ì‹œ)
            const actualCustomerShippingAmount = customerShippingAmountSelected;
            const customerShippingSurchargeRate = 0.033; // ê³ ì • ë°°ì†¡ë¹„ ìˆ˜ìˆ˜ë£Œìœ¨

            // 4. ê³ ê°ë¶€ë‹´ ë°°ì†¡ë¹„ì— ëŒ€í•œ ìˆ˜ìˆ˜ë£Œ ê³„ì‚° (3.3%)
            const customerShippingSurcharge = actualCustomerShippingAmount * customerShippingSurchargeRate;

            // 5. íŒë§¤ì±„ë„ ì •ì‚°ê¸ˆì•¡ ê³„ì‚°
            const salesChannelSettlement = salePrice + actualCustomerShippingAmount - channelFee - customerShippingSurcharge;
            
            // 6. í¬ì¥ë¹„ìš© ê³„ì‚°
            const packagingCost = salePrice * packagingCostRate;

            // 7. ê´‘ê³  ì „ íŒë§¤ ë§ˆì§„ ê³„ì‚°
            const marginBeforeAdvertising = salesChannelSettlement - purchasePrice - packagingCost - outgoingShippingCost;
            
            let finalMarginKRW = marginBeforeAdvertising;
            let advertisingCost = 0;

            // 8. ê´‘ê³ ë¹„ ê³„ì‚° ë° ìµœì¢… ë§ˆì§„ ì¡°ì • (ê´‘ê³  ì§‘í–‰ ì‹œ)
            const advertisingCostItemDiv = document.getElementById('resAdvertisingCostItem');
            if (isAdvertising) {
                advertisingCost = salePrice * (advertisingRate / 100);
                finalMarginKRW = marginBeforeAdvertising - advertisingCost;
                advertisingCostItemDiv.classList.remove('hidden');
            } else {
                 advertisingCostItemDiv.classList.add('hidden');
            }

            // 9. ìµœì¢… íŒë§¤ ë§ˆì§„ìœ¨ ê³„ì‚°
            const finalMarginPercentage = salePrice > 0 ? (finalMarginKRW / salePrice) * 100 : 0;

            // ê²°ê³¼ í‘œì‹œ (ìƒì„¸ í•­ëª© ì¶”ê°€)
            document.getElementById('resSalePrice').textContent = `${Math.round(salePrice).toLocaleString()} ì›`;
            document.getElementById('resCustomerShippingAmount').textContent = `${Math.round(actualCustomerShippingAmount).toLocaleString()} ì›`;
            document.getElementById('resChannelFee').textContent = `- ${Math.round(channelFee).toLocaleString()} ì› (${(channelFeeRateValue * 100).toFixed(1)}%)`;
            document.getElementById('resCustomerShippingSurcharge').textContent = `- ${Math.round(customerShippingSurcharge).toLocaleString()} ì› (${(customerShippingSurchargeRate * 100).toFixed(1)}%)`;
            
            document.getElementById('salesChannelSettlementResult').textContent = `${Math.round(salesChannelSettlement).toLocaleString()} ì›`;
            
            document.getElementById('resPurchasePrice').textContent = `- ${Math.round(purchasePrice).toLocaleString()} ì›`;
            document.getElementById('resPackagingCost').textContent = `- ${Math.round(packagingCost).toLocaleString()} ì› (${(packagingCostRate * 100).toFixed(0)}%)`;
            document.getElementById('resOutgoingShippingCost').textContent = `- ${Math.round(outgoingShippingCost).toLocaleString()} ì›`;
            
            document.getElementById('resMarginBeforeAdvertising').textContent = `${Math.round(marginBeforeAdvertising).toLocaleString()} ì›`;

            if(isAdvertising) {
                document.getElementById('resAdvertisingCost').textContent = `- ${Math.round(advertisingCost).toLocaleString()} ì› (${advertisingRate.toFixed(0)}%)`;
            }
            
            const finalMarginKRWEl = document.getElementById('finalMarginKRWResult');
            const finalMarginPercentageEl = document.getElementById('finalMarginPercentageResult');

            finalMarginKRWEl.textContent = `${Math.round(finalMarginKRW).toLocaleString()} ì› ${finalMarginKRW < 0 ? '(ì†ì‹¤ ğŸ˜¥)' : '(ì´ìµ ï¿½)'}`;
            finalMarginPercentageEl.textContent = `${finalMarginPercentage.toFixed(2)} %`;

            finalMarginKRWEl.classList.remove('profit', 'loss');
            finalMarginPercentageEl.classList.remove('profit', 'loss');

            if (finalMarginKRW < 0) {
                finalMarginKRWEl.classList.add('loss');
                finalMarginPercentageEl.classList.add('loss');
            } else {
                finalMarginKRWEl.classList.add('profit');
                finalMarginPercentageEl.classList.add('profit');
            }
            
            resultsDiv.classList.remove('hidden'); // ë¨¼ì € hiddenì„ ì œê±°í•˜ê³ 
            setTimeout(() => { // ì•½ê°„ì˜ ë”œë ˆì´ í›„ show í´ë˜ìŠ¤ ì¶”ê°€í•˜ì—¬ ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±°
                 resultsDiv.classList.add('show');
            }, 50);


        });

        function displayError(message) {
            errorMessageDiv.textContent = message;
            errorMessageDiv.classList.remove('hidden');
            resultsDiv.classList.add('hidden'); // ì˜¤ë¥˜ ë°œìƒ ì‹œ ì´ì „ ê²°ê³¼ ìˆ¨ê¹€
            resultsDiv.classList.remove('show'); // ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ë„ ì œê±°
        }
    </script>
</body>
</html>
ï¿½
